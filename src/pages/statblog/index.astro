---
import SiteLayout from "../../layouts/SiteLayout.astro";
import { siteConfig } from "../../config";
import { getCollection } from "astro:content";

const allPosts = await getCollection("statblog");

const posts = allPosts
  .filter((p) => !p.slug.startsWith("_"))
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<SiteLayout pageTitle="StatBlog" siteConfig={siteConfig}>
  <main class="mx-auto max-w-4xl px-4 py-10">
    <header class="mb-8">
      <h1 class="text-3xl font-semibold tracking-tight">StatBlog</h1>
      <p class="mt-2 text-gray-600">
        Short notes and longer write-ups on statistics topics I find interesting.
      </p>
    </header>

    {posts.length === 0 ? (
      <p class="text-gray-600">
        No posts yet. Create a new file in <code>src/content/statblog</code> by copying
        <code>_template.md</code>.
      </p>
    ) : (
      <ul class="space-y-4">
        {posts.map((post) => (
          <li class="rounded-xl border border-gray-200 bg-white/60 p-4 backdrop-blur">
            <a href={`/statblog/${post.slug}`} class="group flex items-center gap-4">
              <div class="h-12 w-24 shrink-0 overflow-hidden rounded-lg border border-gray-200 bg-gray-50">
                {post.data.thumbnail ? (
                  <img
                    src={post.data.thumbnail}
                    alt={`${post.data.title} thumbnail`}
                    class="h-full w-full object-cover"
                    loading="lazy"
                  />
                ) : null}
              </div>

              <div class="min-w-0">
                <div class="flex flex-wrap items-baseline gap-x-3 gap-y-1">
                  <h2 class="text-lg font-medium text-gray-900 group-hover:underline">
                    {post.data.title}
                  </h2>
                  <span class="text-sm text-gray-500">
                    {post.data.date.toLocaleDateString("en-US", {
                      year: "numeric",
                      month: "short",
                      day: "2-digit",
                    })}
                  </span>
                </div>

                {post.data.description ? (
                  <p class="mt-1 line-clamp-2 text-sm text-gray-600">
                    {post.data.description}
                  </p>
                ) : null}
              </div>
            </a>
          </li>
        ))}
      </ul>
    )}
  </main>
</SiteLayout>
