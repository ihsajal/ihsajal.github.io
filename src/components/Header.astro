---
import { siteConfig } from "../config";

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasExperience = siteConfig.experience && siteConfig.experience.length > 0;
const hasEducation = siteConfig.education && siteConfig.education.length > 0;
const hasHonors = siteConfig.honors && siteConfig.honors.length > 0;
const hasPublications = siteConfig.publications && siteConfig.publications.length > 0;
const hasTalks = siteConfig.talks && siteConfig.talks.length > 0;
const hasCV =
  !!siteConfig.cv?.pdf ||
  (siteConfig.references && siteConfig.references.length > 0);

// Make header links work both on homepage and project pages
const isHome = Astro.url.pathname === "/" || Astro.url.pathname === "/index";
const homePrefix = isHome ? "" : "/";

const navItems = [
  { label: "About", href: homePrefix + "#about", show: true },
  { label: "Projects", href: homePrefix + "#projects", show: hasProjects },
  { label: "Experience", href: homePrefix + "#experience", show: hasExperience },
  { label: "Education", href: homePrefix + "#education", show: hasEducation },
  { label: "Honors", href: homePrefix + "#honors", show: hasHonors },
  { label: "Publications", href: homePrefix + "#publications", show: hasPublications },
  { label: "Talks", href: homePrefix + "#talks", show: hasTalks },
  { label: "StatBlog", href: "/statblog", show: true },
  { label: "CV", href: homePrefix + "#cv", show: hasCV },

].filter((x) => x.show);
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 py-3">
    <div class="flex items-center justify-between">
      {/* Optional: Name/brand (kept subtle) */}
      <a
        href={homePrefix + "#hero"}
        class="text-sm sm:text-base font-semibold text-gray-900"
        style={`color: ${siteConfig.accentColor}`}
      >
        {siteConfig.name}
      </a>

      {/* Desktop nav */}
      <ul class="hidden md:flex items-center gap-8 justify-center">
        {navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class="text-gray-700 hover:text-black transition-colors font-medium"
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>

      {/* Mobile hamburger button */}
      <button
        id="menuButton"
        type="button"
        class="md:hidden inline-flex items-center justify-center rounded-md border border-gray-200 bg-white px-3 py-2 text-gray-800 shadow-sm"
        aria-label="Open menu"
        aria-expanded="false"
        aria-controls="mobileMenu"
      >
        <svg
          id="menuIcon"
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>

        <svg
          id="closeIcon"
          xmlns="http://www.w3.org/2000/svg"
          class="hidden h-5 w-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    {/* Mobile dropdown */}
    <div
      id="mobileMenu"
      class="md:hidden hidden mt-3 rounded-lg border border-gray-200 bg-white shadow-sm overflow-hidden"
    >
      <ul class="flex flex-col">
        {navItems.map((item) => (
          <li class="border-t border-gray-100 first:border-t-0">
            <a
              href={item.href}
              class="block px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-50 hover:text-black transition-colors"
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </nav>
</header>

<script>
  const header = document.getElementById("header");
  const btn = document.getElementById("menuButton");
  const menu = document.getElementById("mobileMenu");
  const menuIcon = document.getElementById("menuIcon");
  const closeIcon = document.getElementById("closeIcon");

  function setOpen(isOpen) {
    if (!btn || !menu || !menuIcon || !closeIcon) return;
    btn.setAttribute("aria-expanded", String(isOpen));
    menu.classList.toggle("hidden", !isOpen);
    menuIcon.classList.toggle("hidden", isOpen);
    closeIcon.classList.toggle("hidden", !isOpen);
  }

  btn?.addEventListener("click", () => {
    const isOpen = btn.getAttribute("aria-expanded") === "true";
    setOpen(!isOpen);
  });

  // Close menu after clicking any link in the dropdown
  menu?.addEventListener("click", (e) => {
    const t = e.target;
    if (t && t.tagName === "A") setOpen(false);
  });

  // Add background blur after scroll (same behavior as before)
  window.addEventListener("scroll", () => {
    if (window.scrollY > 100) {
      header?.classList.add("bg-white/80", "backdrop-blur-sm");
    } else {
      header?.classList.remove("bg-white/80", "backdrop-blur-sm");
    }
  });
</script>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>
